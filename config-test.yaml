# LLMProxy 本地测试配置

server:
  listen: ":9000"
  read_timeout: 30s
  write_timeout: 60s
  idle_timeout: 120s

log:
  level: debug
  format: text
  output: stdout

# Admin API 配置
admin:
  enabled: true
  token: "test-admin-token-12345"
  listen: ":9001"
  db_path: "./data/keys.db"

# 鉴权配置
auth:
  enabled: false
  mode: first_match
  header_names:
    - Authorization
    - X-API-Key
  # status_codes:
  #   disabled:
  #     http_code: 403
  #     message: "Your API key has been disabled"
  #   quota_exceeded:
  #     http_code: 429
  #     message: "Your quota has been exceeded"
  #   expired:
  #     http_code: 403
  #     message: "Your API key has expired"
  pipeline:
    - name: builtin_auth
      type: builtin
      enabled: true

# 后端服务列表
backends:
  - name: mock-backend
    url: "https://httpbin.org"
    weight: 1

# 路由配置
routing:
  enabled: true
  load_balance: round_robin
  timeout: 60s

# 限流配置
rate_limit:
  enabled: false

# 健康检查
health_check:
  enabled: false

# 指标
metrics:
  enabled: true
  path: /metrics

# 请求/访问日志配置
logging:
  enabled: true
  request:
    enabled: false  # 需要数据库，暂时禁用
  access:
    enabled: true
    format: json
    output: stdout

# 生命周期钩子配置
hooks:
  enabled: true
  on_request:
    enabled: true
    timeout: 100ms
    script: |
      log("[Hook] on_request: " .. request.method .. " " .. request.path)
      return { continue = true }
  on_response:
    enabled: true
    timeout: 100ms
    script: |
      log("[Hook] on_response: status=" .. response.status_code .. " latency=" .. response.latency_ms .. "ms")
      return { continue = true }
  on_complete:
    enabled: true
    timeout: 100ms
    script: |
      log("[Hook] on_complete: " .. request.path .. " completed")
