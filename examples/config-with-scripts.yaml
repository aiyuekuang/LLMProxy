# LLMProxy 配置示例（包含 Lua 脚本）
# 完整配置参考: docs/config-reference.yaml

server:
  listen: ":8000"

log:
  level: info
  format: json
  output: stdout

# 后端服务器列表
backends:
  - name: standard
    url: "http://standard-backend:8000"
    weight: 10
  - name: high-performance
    url: "http://high-performance-backend:8000"
    weight: 10
  - name: ultra
    url: "http://ultra-backend:8000"
    weight: 10

# Admin API 配置
admin:
  enabled: true
  token: "your-admin-token"
  db_path: "./data/keys.db"

# 鉴权配置
auth:
  enabled: true
  mode: first_match
  header_names:
    - Authorization
    - X-API-Key
  skip_paths:
    - /health
    - /metrics
  pipeline:
    # 使用内置 SQLite 存储
    - name: builtin_auth
      type: builtin
      enabled: true
    # 或者使用静态配置
    - name: static_keys
      type: static
      enabled: false
      static:
        keys:
          - key: "sk-llmproxy-vip-001"
            name: "VIP 用户"
            user_id: "user_vip_001"
            status: "active"
            total_quota: 5000000
          - key: "sk-llmproxy-normal-001"
            name: "普通用户"
            user_id: "user_normal_001"
            status: "active"
            total_quota: 100000

# 路由配置
routing:
  enabled: true
  load_balance: least_connections
  timeout: 60s
  retry:
    enabled: true
    max_retries: 3
    initial_wait: 1s
    max_wait: 10s
    multiplier: 2.0

# 限流配置
rate_limit:
  enabled: true
  storage: memory
  global:
    enabled: true
    requests_per_second: 1000
    burst_size: 2000
  per_key:
    enabled: true
    requests_per_second: 10
    requests_per_minute: 500
    tokens_per_minute: 100000
    max_concurrent: 5
    burst_size: 20

# 用量上报配置
usage:
  enabled: true
  reporters:
    - name: local
      type: builtin
      enabled: true
      builtin:
        retention_days: 30
    - name: billing
      type: webhook
      enabled: true
      webhook:
        url: "http://billing-service:8080/api/v1/usage"
        timeout: 2s
        retry: 3

# 健康检查
health_check:
  enabled: true
  interval: 10s
  path: /health

# 生命周期钩子（Lua 脚本）
hooks:
  enabled: true
  # 请求钩子
  on_request:
    enabled: true
    timeout: 100ms
    path: "/etc/llmproxy/scripts/on_request.lua"
  # 响应钩子
  on_response:
    enabled: true
    timeout: 50ms
    path: "/etc/llmproxy/scripts/on_response.lua"
  # 错误钩子
  on_error:
    enabled: true
    timeout: 50ms
    path: "/etc/llmproxy/scripts/on_error.lua"
